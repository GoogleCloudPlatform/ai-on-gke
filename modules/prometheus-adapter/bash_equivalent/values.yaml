rules:
  external:
  - seriesQuery: 'jetstream_prefill_backlog_size'
    resources:
      template: <<.Resource>>
    name:
      matches: ""
      as: "jetstream_prefill_backlog_size"
    metricsQuery: sum(<<.Series>>{<<.LabelMatchers>>,cluster="lws-jetstream"})
  - seriesQuery: 'jetstream_transfer_backlog_size'
    resources:
      template: <<.Resource>>
    name:
      matches: ""
      as: "jetstream_transfer_backlog_size"
    metricsQuery: sum(<<.Series>>{<<.LabelMatchers>>,cluster="lws-jetstream"})
  - seriesQuery: 'jetstream_generate_backlog_size'
    resources:
      template: <<.Resource>>
    name:
      matches: ""
      as: "jetstream_generate_backlog_size"
    metricsQuery: sum(<<.Series>>{<<.LabelMatchers>>,cluster="lws-jetstream"})
  - seriesQuery: 'jetstream_slots_used_percentage'
    resources:
      template: <<.Resource>>
    name:
      matches: ""
      as: "jetstream_slots_used_percentage"
    metricsQuery: sum(<<.Series>>{<<.LabelMatchers>>,cluster="lws-jetstream"})
  - seriesQuery: 'kubernetes_io:node_accelerator_memory_used'
    resources:
      template: <<.Resource>>
    name:
      matches: ""
      as: "my_external_metric"
    metricsQuery: avg(kubernetes_io:node_accelerator_memory_used{<<.LabelMatchers>>,cluster_name="lws-jetstream"}) / avg(kubernetes_io:node_accelerator_memory_total{<<.LabelMatchers>>,cluster_name="lws-jetstream"})