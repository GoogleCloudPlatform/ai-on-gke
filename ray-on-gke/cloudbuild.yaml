steps:
  - id: 'tf validate platform'
    name: 'hashicorp/terraform:1.0.0'
    env:
      - "PROJECT_ID=$PROJECT_ID"
    script: |
      cd ray-on-gke/platform
      terraform init
      terraform validate
      terraform apply -auto-approve -var=project_id=${PROJECT_ID} -var=cluster_name=ml-cluster-${SHORT_SHA}
      terraform destroy -auto-approve
    waitFor: ['-']
  
  # - id: 'tf validate user'
  #   name: 'hashicorp/terraform:1.0.0'
  #   script: |
  #     cd ray-on-gke/user
  #     terraform init
  #     terraform validate 
  #   waitFor: ['tf validate platform']

