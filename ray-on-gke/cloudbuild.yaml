steps:
  - id: 'tf validate platform'
    name: 'hashicorp/terraform:1.0.0'
    env:
      - "TF_IN_AUTOMATION=TRUE"
      # - "TF_LOG=DEBUG"
      # - "PROJECT_ID=$PROJECT_ID"
      # - "PR_NUMBER=$_PR_NUMBER"
      # - "BUILD_ID=$BUILD_ID"
      # - "SHORT_SHA=$SHORT_SHA"
    entrypoint: 'sh'
    args: 
    - '-c'
    - |
      terraform init 
      terraform validate
    dir: 'ray-on-gke/platform/'
    # script: |
    #   terraform init
    #   terraform validate
    #   terraform apply -auto-approve -var=project_id=$PROJECT_ID -var=cluster_name=cluster-$SHORT_SHA-$PR_NUMBER
    waitFor: ['-']

  # - id: 'tf apply platform'
  #   name: 'hashicorp/terraform:1.0.0'
  #   dir: 'ray-on-gke/platform/'
  #   waitFor: ['tf validate platform']
  #   entrypoint: 'sh'
  
  # - id: 'tf validate user'
  #   name: 'hashicorp/terraform:1.0.0'
  #   script: |
  #     cd ray-on-gke/user
  #     terraform init
  #     terraform validate 
  #   waitFor: ['tf validate platform']

