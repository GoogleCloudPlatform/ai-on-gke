steps:
  - id: 'tf validate platform'
    name: 'hashicorp/terraform:1.0.0'
    env:
      - "PROJECT_ID=$PROJECT_ID"
      - "PR_NUMBER=$_PR_NUMBER"
      - "BUILD_ID=$BUILD_ID"
      - "SHORT_SHA=$SHORT_SHA"
      - "KUBECONFIG=/workspace/kubeconfig"
    script: |
      cd ray-on-gke/platform
      terraform init
      terraform validate
      terraform apply -auto-approve -var=project_id=${PROJECT_ID} -var=cluster_name=cluster-${SHORT_SHA}-${PR_NUMBER}
      terraform destroy -auto-approve
    waitFor: ['-']
  
  # - id: 'tf validate user'
  #   name: 'hashicorp/terraform:1.0.0'
  #   script: |
  #     cd ray-on-gke/user
  #     terraform init
  #     terraform validate 
  #   waitFor: ['tf validate platform']

