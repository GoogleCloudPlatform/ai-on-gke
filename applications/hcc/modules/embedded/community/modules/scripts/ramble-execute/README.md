## Description

This module will create a startup-script runner that will execute Ramble commands.

Ramble is a multi-platform experimentation framework capable of driving
software installation, acquiring input files, configuring experiments, and
extracting results. For more information about Ramble, see:
https://github.com/GoogleCloudPlatform/ramble

This module outputs a startup script runner, which can be combined with other
startup script runners to execute a set of Ramble commands.

Ramble makes extensive use of Spack. It must be installed with a Toolkit runner
generated by the [spack-setup module](../spack-setup/README.md) following the
[basic example](#basic-example) below.

> **_NOTE:_** This is an experimental module and the functionality and
> documentation will likely be updated in the near future. This module has only
> been tested in limited capacity.

# Examples

## Basic Example

Below is a basic example of using this module.

```yaml
  - id: spack
    source: community/modules/scripts/spack-setup

  - id: ramble-setup
    source: community/modules/scripts/ramble-setup

  - id: ramble-execute
    source: community/modules/scripts/ramble-execute
    use: [spack, ramble-setup]
    settings:
      commands:
      - ramble list
```

This example shows installing Spack and Ramble with their own modules
(spack-setup and ramble-setup respectively). Then the ramble-execute module
is added to simply list all applications Ramble knows about.

## License

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
Copyright 2023 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.0.0 |
| <a name="requirement_local"></a> [local](#requirement\_local) | >= 2.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_local"></a> [local](#provider\_local) | >= 2.0.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_startup_script"></a> [startup\_script](#module\_startup\_script) | ../../../../modules/scripts/startup-script | n/a |

## Resources

| Name | Type |
|------|------|
| [local_file.debug_file_ansible_execute](https://registry.terraform.io/providers/hashicorp/local/latest/docs/resources/file) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_commands"></a> [commands](#input\_commands) | String of commands to run within this module | `string` | `null` | no |
| <a name="input_data_files"></a> [data\_files](#input\_data\_files) | A list of files to be transferred prior to running commands. <br/>It must specify one of 'source' (absolute local file path) or 'content' (string).<br/>It must specify a 'destination' with absolute path where file should be placed. | `list(map(string))` | `[]` | no |
| <a name="input_deployment_name"></a> [deployment\_name](#input\_deployment\_name) | Name of deployment, used to name bucket containing spack scripts. | `string` | n/a | yes |
| <a name="input_gcs_bucket_path"></a> [gcs\_bucket\_path](#input\_gcs\_bucket\_path) | The GCS path for storage bucket and the object, starting with `gs://`. | `string` | n/a | yes |
| <a name="input_labels"></a> [labels](#input\_labels) | Key-value pairs of labels to be added to created resources. | `map(string)` | n/a | yes |
| <a name="input_log_file"></a> [log\_file](#input\_log\_file) | Log file to write output from Ramble execute steps into | `string` | `"/var/log/ramble-execute.log"` | no |
| <a name="input_project_id"></a> [project\_id](#input\_project\_id) | Project in which the HPC deployment will be created. | `string` | n/a | yes |
| <a name="input_ramble_profile_script_path"></a> [ramble\_profile\_script\_path](#input\_ramble\_profile\_script\_path) | Path to the Ramble profile.d script. Created by an instance of ramble-setup.<br/>Can be defined explicitly, or by chaining an instance of a ramble-setup module<br/>through a `use` setting. | `string` | n/a | yes |
| <a name="input_ramble_runner"></a> [ramble\_runner](#input\_ramble\_runner) | Runner from previous ramble-setup or ramble-execute to be chained with scripts generated by this module. | <pre>object({<br/>    type        = string<br/>    content     = string<br/>    destination = string<br/>  })</pre> | n/a | yes |
| <a name="input_region"></a> [region](#input\_region) | Region to place bucket containing spack scripts. | `string` | n/a | yes |
| <a name="input_spack_profile_script_path"></a> [spack\_profile\_script\_path](#input\_spack\_profile\_script\_path) | Path to the Spack profile.d script.<br/>Can be defined explicitly, or by chaining an instance of a spack-setup module<br/>through a `use` setting.<br/>Defaults to /etc/profile.d/spack.sh if not set. | `string` | `"/etc/profile.d/spack.sh"` | no |
| <a name="input_system_user_name"></a> [system\_user\_name](#input\_system\_user\_name) | Name of the system user used to execute commands. Generally passed from the ramble-setup module. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_controller_startup_script"></a> [controller\_startup\_script](#output\_controller\_startup\_script) | Ramble startup script, duplicate for SLURM controller. |
| <a name="output_gcs_bucket_path"></a> [gcs\_bucket\_path](#output\_gcs\_bucket\_path) | Bucket containing the startup scripts for ramble, to be reused by ramble-execute module. |
| <a name="output_ramble_profile_script_path"></a> [ramble\_profile\_script\_path](#output\_ramble\_profile\_script\_path) | Path to Ramble profile script. |
| <a name="output_ramble_runner"></a> [ramble\_runner](#output\_ramble\_runner) | Runner to execute Ramble commands using an ansible playbook. The startup-script module<br/>will automatically handle installation of ansible. |
| <a name="output_spack_profile_script_path"></a> [spack\_profile\_script\_path](#output\_spack\_profile\_script\_path) | Path to Spack profile script. |
| <a name="output_startup_script"></a> [startup\_script](#output\_startup\_script) | Ramble startup script. |
| <a name="output_system_user_name"></a> [system\_user\_name](#output\_system\_user\_name) | The system user used to execute commands. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
