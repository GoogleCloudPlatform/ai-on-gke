apiVersion: batch/v1
kind: Job
metadata:
  name: bionemo-e2e-test
spec:
  template:
    spec:
      containers:
      - name: e2e-test
        image: nvcr.io/nvidia/clara/bionemo-framework:2.1
        command: ["/bin/bash", "-c"]
        args:
        - |
          # Run minimal training job
          python scripts/protein/esm2/esm2_pretrain.py \
            --num-steps 10 \
            --val-check-interval 5 \
            --micro-batch-size 1 \
            --num-layers 2 \
            # Minimal configuration for testing
          
          # Check for training artifacts
          if [ ! -d "/workspace/bionemo2/results/lightning_logs" ]; then
            echo "Training artifacts not found"
            exit 1
          fi
        resources:
          limits:
            nvidia.com/gpu: 1
      restartPolicy: Never