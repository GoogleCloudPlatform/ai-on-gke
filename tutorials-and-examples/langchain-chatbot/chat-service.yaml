apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: chat
  namespace: langchain-chatbot
spec:
  template:
    spec:
      containers:
        - name: app
          image: <image-name>:latest
          imagePullPolicy: Always
          env:
            - name: MODEL_BASE_URL
              value: "http://gemma2.langchain-chatbot.svc.cluster.local/openai/v1/"
            - name: MODEL_NAME
              value: "gemma2"
            - name: DB_URI
              value: "postgresql://postgres:<db-password>@<db-private-ip-address>:5432/chat"
          ports:
            - containerPort: 8501
          livenessProbe:
            httpGet:
              path: /_stcore/health
              port: 8501
              scheme: HTTP
            timeoutSeconds: 1
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /_stcore/health
              port: 8501
              scheme: HTTP
            timeoutSeconds: 1
            periodSeconds: 10
          resources:
            limits:
              cpu: 1
              memory: 2Gi
            requests:
              cpu: 100m
              memory: 745Mi